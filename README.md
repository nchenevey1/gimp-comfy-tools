# GIMP 3.0 - ComfyUI Integration Plugin

This project bridges **GIMP 3.0** and **ComfyUI**, allowing you to generate AI images directly within GIMP using a ComfyUI instance. It consists of two distinct plugins: **Generation Studio** and **Metadata Viewer**.

## Table of Contents

* <a href="#plugins">Plugins Included</a>
* <a href="#usage">Usage</a>
* <a href="#structure">Project Structure</a>
* <a href="#installation">Installation</a>
* <a href="#configuration">Configuration</a>
* <a href="#troublshooting">Troubleshooting</a>
* <a href="#libraries">Bundled Libraries & Licenses</a>

---

## <a id="plugins" href="#toc">Plugins Included</a>

### 1. ComfyUI Studio (`gimp-generate-pers`)

A comprehensive panel for orchestrating Stable Diffusion workflows.

* **Text-to-Image & Image-to-Image:** Send GIMP layers to ComfyUI and receive results as new layers
* **Masking:** Automatically converts GIMP selections into masks for inpainting
* **Workflow Manager:** Import, manage, and switch between ComfyUI workflows (in API format)
* **Model Management:** Browse and select Checkpoints and LoRAs *Note: Applied LoRAs affect the selected checkpoint globally for the current generation*
* **History & Styles:** Save prompt history and create reusable style presets

### 2. Metadata Viewer (`gimp-metadata-viewer`)

A utility to inspect generation data.

* Reads invisible GIMP "parasites" attached to generated layers
* Displays the full prompt, seed, sampler settings, and workflow used to create the image
* Persists even after saving/reopening `.xcf` files

---

## <a id="usage" href="#toc">Usage</a>

### Generating Images

1. Go to **Generate Panel** > **ComfyUI Studio**.
2. **Target Image:** Select the open image you wish to work on or none if generating a new one
3. **Workflow:** Select a workflow (default generation and inpainting workflows are included)
4. **Settings:** Adjust prompt, steps, CFG, add LoRAs, etc
5. **Generate:** Click generate
* *If you have an active selection in GIMP, it will be sent as a Mask*

#### Generation
https://github.com/user-attachments/assets/f9a51c9b-9044-4404-9386-bd5c369ad4e1

#### Inpainting
https://github.com/user-attachments/assets/273ba937-b246-4d61-b8b3-64901c5bc1d6

#### Object Removal (Works best on small objects)
https://github.com/user-attachments/assets/8ac9ffb4-3754-4c24-aa69-4a2f5b5191ea

### Viewing Metadata

1. Select a layer generated by the studio
2. Go to **Generate Panel** > **View ComfyUI Metadata**
3. A window will pop up displaying the generation parameters (Seed, Prompt, Model, etc.)

---

## <a id="structure" href="#toc">Project Structure</a>

To function properly, the plugins rely on the `modules` directory.

```text
/your-gimp-plugins-folder/
│
├── modules/                  # Shared core & vendorized libs
│   ├── comfy_client.py       # API handling
│   ├── config.py             # Settings
│   ├── requests/             # Bundled dependency
│   ├── websocket/            # Bundled dependency
│   └── ... (other utils)
│
├── gimp-generate-pers/       # Generation Plugin
│   └── gimp-generate-pers.py
│
└── gimp-metadata-viewer/     # Metadata Plugin
    └── gimp-metadata-viewer.py

```

---

## <a id="installation" href="#toc">Installation</a>

### Prerequisites

* **GIMP 3.0** (RC or newer). This will **not** work on GIMP 2.10
* **ComfyUI** installed and running
* **Python 3** (Bundled with GIMP 3)

### Steps

1. **Download the Plug-in Files**
* Ensure the file structure matches the diagram above


2. **Locate your GIMP Plug-ins folder:**
* Open GIMP
* Go to `Edit` > `Preferences` > `Folders` > `Plug-ins`
* Click the folder icon and open the plug-in directory location


3. **Restart GIMP**

---

## <a id="configuration" href="#toc">Configuration</a>

### ComfyUI Setup

Ensure ComfyUI is running. By default, the plugin expects it at:
`http://127.0.0.1:8188`

If you run ComfyUI with arguments, standard usage is fine. If running remotely or inside Docker, ensure the port is accessible.

### Plugin Configuration

On the first run, the plugin will create a config folder at:

* **Linux:** `~/.config/GIMP/3.0/comfy/`
* **Windows:** `%APPDATA%\GIMP\3.0\comfy\`

You can use the "Manage Workflows" UI to import your workflows.

> **Note on Workflows:** The plugin uses the **API Format** (no node graph UI data), not the standard save format. In ComfyUI, enable "Enable Dev mode Options" in settings, then use the "Save (API Format)" button.

---

## <a id="troubleshooting" href="#toc">Troubleshooting</a>

**"Plugin does not appear in menu"**

* Check GIMP 3.0 compatibility
* Check file permissions (Linux/Mac)
* Run GIMP from the terminal/command prompt to see Python startup errors

**"Connection Failed"**

* Ensure ComfyUI is running at `127.0.0.1:8188`
* If using a custom address, edit `modules/config.py`

**"ImportError: No module named..."**

* Ensure the `modules` folder is in the **root** of your GIMP plug-ins directory, sitting alongside the plugin folders, not inside them

---

## <a id="libraries" href="#toc">Bundled Libraries and Licenses</a>

For user convenience and ease of installation, this project bundles several external Python libraries in the `modules` directory. These libraries are distributed under their respective licenses:

* **Requests** - Apache 2.0 License
* **Urllib3** - MIT License
* **Websocket-client** - Apache 2.0 License
* **Certifi** - Mozilla Public License 2.0 (MPL 2.0)
* **Charset-normalizer** - MIT License
* **Idna** - BSD-3-Clause License

Please refer to the license files included within each library's subdirectory in `modules/` for full details.